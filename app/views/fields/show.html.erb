<% content_for :title, @field.name %>

<% content_for :header do %>
  <%= render 'shared/fields_header' %>
<% end %>

<div class="min-h-screen bg-gray-50">
  <!-- Header de la fili√®re -->
  <div class="bg-white shadow-sm">
    <div class="container mx-auto px-4 py-8">
      <div class="mb-4">
        <%= link_to "‚Üê Retour aux fili√®res", fields_path, class: "text-primary hover:text-primary-600 font-medium" %>
      </div>
      
      <div class="max-w-4xl">
        <h1 class="text-4xl font-bold text-gray-900 mb-4"><%= @field.name %></h1>
        <% if @field.description.present? %>
          <div class="prose prose-lg text-gray-700 max-w-none">
            <%= simple_format(@field.description) %>
          </div>
        <% end %>
        
        <div class="mt-6 flex items-center gap-4 text-sm text-gray-600">
          <span class="flex items-center gap-1">
            <span class="material-icons text-lg">route</span>
            <%= pluralize(@roadmaps.count, 'roadmap') %> disponible<%= 's' if @roadmaps.count > 1 %>
          </span>
          <span class="flex items-center gap-1">
            <span class="material-icons text-lg">timeline</span>
            Parcours progressifs
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Roadmaps -->
  <div class="container mx-auto px-4 py-8">
    <% if @roadmaps.any? %>
      <div class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-900 mb-2">Roadmaps disponibles</h2>
        <p class="text-gray-600">Choisissez le parcours qui correspond √† vos objectifs</p>
      </div>

      <div class="space-y-8">
        <% @roadmaps.each_with_index do |roadmap, index| %>
          <div class="bg-white rounded-lg shadow-md overflow-hidden" data-controller="roadmap-preview">
            <!-- Header de la roadmap -->
            <div class="p-6 border-b border-gray-200">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <span class="flex items-center justify-center w-8 h-8 bg-primary text-white text-sm font-bold rounded-full">
                      <%= index + 1 %>
                    </span>
                    <h3 class="text-xl font-semibold text-gray-900"><%= roadmap.title %></h3>
                  </div>
                  
                  <% if roadmap.description.present? %>
                    <p class="text-gray-600 leading-relaxed ml-11">
                      <%= roadmap.description %>
                    </p>
                  <% end %>
                </div>
                
                <button data-action="roadmap-preview#toggle" 
                        data-roadmap-preview-target="toggleButton"
                        class="flex items-center gap-2 px-4 py-2 text-primary border border-primary rounded-lg hover:bg-primary hover:text-white transition-colors">
                  <span data-roadmap-preview-target="toggleText">Voir les √©tapes</span>
                  <span class="material-icons transition-transform" data-roadmap-preview-target="toggleIcon">expand_more</span>
                </button>
              </div>
              
              <div class="mt-4 ml-11 flex items-center gap-4 text-sm text-gray-500">
                <span class="flex items-center gap-1">
                  <span class="material-icons text-sm">linear_scale</span>
                  <%= pluralize(roadmap.roadmap_steps.count, '√©tape') %>
                </span>
                <span class="flex items-center gap-1">
                  <span class="material-icons text-sm">schedule</span>
                  Parcours progressif
                </span>
              </div>
            </div>

            <!-- Timeline des √©tapes (collapsible) -->
            <div data-roadmap-preview-target="content" class="hidden">
              <div class="p-6">
                <% if roadmap.roadmap_steps.any? %>
                  <div class="relative">
                    <!-- Timeline verticale -->
                    <% roadmap.roadmap_steps.ordered.each_with_index do |step, step_index| %>
                      <div class="flex gap-4 <%= 'pb-8' unless step_index == roadmap.roadmap_steps.count - 1 %>">
                        <!-- Num√©ro et ligne de connexion -->
                        <div class="flex flex-col items-center">
                          <div class="flex items-center justify-center w-10 h-10 bg-primary text-white font-bold rounded-full border-4 border-white shadow-md z-10">
                            <%= step.order %>
                          </div>
                          <% unless step_index == roadmap.roadmap_steps.count - 1 %>
                            <div class="w-0.5 h-full bg-gray-200 mt-2"></div>
                          <% end %>
                        </div>

                        <!-- Contenu de l'√©tape -->
                        <div class="flex-1 <%= 'pb-6' unless step_index == roadmap.roadmap_steps.count - 1 %>">
                          <h4 class="text-lg font-medium text-gray-900 mb-3"><%= step.title %></h4>
                          
                          <div class="space-y-3">
                            <div class="bg-orange-50 border-l-4 border-orange-400 p-3 rounded">
                              <div class="flex items-start gap-2">
                                <span class="material-icons text-orange-600 text-sm mt-0.5">target</span>
                                <div>
                                  <span class="font-medium text-orange-800">Objectif</span>
                                  <p class="text-orange-700 text-sm mt-1"><%= simple_format(step.objective) %></p>
                                </div>
                              </div>
                            </div>

                            <% if step.skills.present? %>
                              <div class="bg-green-50 border-l-4 border-green-400 p-3 rounded">
                                <div class="flex items-start gap-2">
                                  <span class="material-icons text-green-600 text-sm mt-0.5">check_circle</span>
                                  <div>
                                    <span class="font-medium text-green-800">Comp√©tences √† d√©velopper</span>
                                    <p class="text-green-700 text-sm mt-1"><%= simple_format(step.skills) %></p>
                                  </div>
                                </div>
                              </div>
                            <% end %>

                            <% if step.activities.present? %>
                              <div class="bg-blue-50 border-l-4 border-blue-400 p-3 rounded">
                                <div class="flex items-start gap-2">
                                  <span class="material-icons text-blue-600 text-sm mt-0.5">assignment</span>
                                  <div>
                                    <span class="font-medium text-blue-800">Activit√©s</span>
                                    <p class="text-blue-700 text-sm mt-1"><%= simple_format(step.activities) %></p>
                                  </div>
                                </div>
                              </div>
                            <% end %>
                          </div>
                        </div>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <div class="text-center py-8 text-gray-500">
                    <span class="material-icons text-4xl mb-2">build</span>
                    <p>Cette roadmap est en cours de construction</p>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-16">
        <div class="text-gray-400 text-6xl mb-4">üöß</div>
        <h3 class="text-xl font-medium text-gray-900 mb-2">Roadmaps en pr√©paration</h3>
        <p class="text-gray-600 mb-6">Les parcours pour cette fili√®re sont actuellement en d√©veloppement.</p>
        <%= link_to "Voir d'autres fili√®res", fields_path, class: "inline-flex items-center bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary-600 transition-colors" %>
      </div>
    <% end %>
  </div>
</div>
